---
title: "Workflow Example"
author: "Zachary Foster"
date: "`r Sys.Date()`"
output: rmarkdown::html_vignette
vignette: >
%\VignetteIndexEntry{Vignette Title}
%\VignetteEngine{knitr::rmarkdown}
%\usepackage[utf8]{inputenc}
---
```{r}
seq <- download_gb_taxon(taxon = c("phytophthora", "pythium"),
                         key = c("@18S@", "@28S@"),
                         type = "RRNA",
                         seq_length=c(3000, 100000))


taxonomy <- taxize::classification(seq$taxon, db="col", verbose=FALSE)
seq <- seq[!is.na(taxonomy), ]
taxonomy <- taxonomy[!is.na(taxonomy)]
taxonomy <- format_taxize(taxonomy)


pcr <- primersearch(sequence = seq$sequence,
                    forward = "TCCGTAGGTGAACCTGCGG",
                    reverse = "CGCATTACGTATCGCAGTTCGCAG",
                    seq_name = taxonomy,
                    pair_name = "ITS1__and__OOM-LO5.8S47B",
                    mismatch = 10)

nodes <- get_nodes_from_leafs(taxonomy)
seq_counts <- count_nodes_in_leafs(taxonomy, nodes)
pcr_counts <- count_nodes_in_leafs(pcr$name, nodes)
pcr_proportions <- pcr_counts / seq_counts

dist_matrix <- pairwise_distance(sequences = pcr$amplicon,
                                 seq_name = pcr$name)


calculate_barcode_statistics(adist_matrix,
                             saved_output_path = "~/test",
                             save_statistics = TRUE,
                             save_raw_data = TRUE,
                             save_plots = TRUE,
                             distance_bin_width = 0.001,
                             threshold_resolution = 0.001)


```