---
title: "Subsetting taxonomic data"
output:
  rmarkdown::html_vignette:
    toc: false
    css: custom.css
vignette: >
  %\VignetteIndexEntry{Subsetting taxonomic data}
  %\VignetteEngine{knitr::rmarkdown}
  %\usepackage[utf8]{inputenc}
---

```{r, echo=FALSE, warning=FALSE, message=FALSE}
library(ape)
library(metacoder)
library(knitr)
library(ggplot2)
library(magrittr)
opts_chunk$set(dev='png', warning = FALSE, message = FALSE, fig.show='hold', fig.width = 7, fig.height = 7)
```


## Introduction

Subsetting taxonomic data is a more subtle problem then it might seem at first.
For example, if you want to remove a taxon, do you remove its supertaxa and subtaxa as well?
What if there are sequences assigned to that taxon; are the sequences removed or reassigned to a preserved supertaxa?
The answers to these questions depend on what the goal of the subsetting is.

### Removing supertaxa

Often, there are many shared ranks in the taxonomic hierarchy that can prevent effective visualization:

```{r}
plot(genbank_ex_data,
     vertex_size = item_count,
     vertex_color = item_count,
     vertex_label = name)
```

`subset` can easily remove these taxa by filtering by rank or selecting the root taxon by name:

```{r}
subset(genbank_ex_data, rank > 5) %>%
  plot(vertex_size = item_count,
       vertex_color = item_count,
       vertex_label = name)
subset(genbank_ex_data, name == "Basidiomycota") %>%
  plot(vertex_size = item_count,
       vertex_color = item_count,
       vertex_label = name)
```

This works because super taxa of filtered taxa are not preserved by `subset` by default.


### Spltting a taxonomy into multiple trees

You can also take a taxonomy with a single root and display it by splitting it at a specified level/rank. 

```{r}
plot(unite_ex_data_3,
     vertex_size = item_count,
     vertex_color = item_count,
     vertex_label = name,
     tree_label = name)
```

We can use `subset` to look at just a single taxon:

```{r}
subset(unite_ex_data_3, name == "Ascomycota") %>%
  plot(vertex_size = item_count,
       vertex_color = item_count,
       vertex_label = name,
       tree_label = name)
```

Or we can remove taxa at the root of the tree by filtering by `rank`:

```{r}
subset(unite_ex_data_3, rank > 1) %>%
  plot(vertex_size = item_count,
       vertex_color = item_count,
       vertex_label = name,
       tree_label = name)
subset(unite_ex_data_3, rank > 3) %>%
  plot(vertex_size = item_count,
       vertex_color = item_count,
       vertex_label = name,
       tree_label = name)
```

